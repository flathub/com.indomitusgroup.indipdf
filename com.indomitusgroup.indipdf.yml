app-id: com.indomitusgroup.indipdf
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk

command: indipdf

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=dri
  - --socket=cups
  # Scanner access (USB and other devices)
  - --device=all
  # Write access to common locations for saving PDFs
  - --filesystem=xdg-download
  - --filesystem=xdg-documents

modules:
  # SANE (Scanner Access Now Easy) for scanner support
  - name: sane-backends
    buildsystem: autotools
    config-opts:
      - --prefix=/app
      - --sysconfdir=/app/etc
      - --localstatedir=/app/var
      - --with-usb
      - --disable-locking
    cleanup:
      - /share/doc
      - /share/man
      - /include
      - /lib/*.a
      - /lib/*.la
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://gitlab.com/sane-project/backends/-/archive/1.4.0/backends-1.4.0.tar.gz
        sha256: 9c50ee76e35d98d7ae0cbb97d4c2a3c15663a78fdd74b0ed2bf2fe8e1a73f63a

  # CUPS client tools (lp, lpstat) for printing support
  - name: cups
    buildsystem: autotools
    config-opts:
      - --disable-systemd
      - --disable-avahi
      - --disable-launchd
      - --disable-dbus
      - --disable-pam
      - --disable-gssapi
      - --disable-ssl
      - --without-rcdir
      - --without-systemd
      - --without-xinetd
      - --without-tls
      - --localstatedir=/app/var
      - --sysconfdir=/app/etc
      - --with-menudir=/app/share/applications
      - --with-icondir=/app/share/icons
      - --with-rundir=/app/var/run/cups
      - --with-logdir=/app/var/log/cups
      - --with-cachedir=/app/var/cache/cups
    cleanup:
      - /sbin
      - /etc
      - /var
      - /lib/cups
      - /share/cups
      - /share/doc
      - /share/man
      - /share/locale
      - /share/applications
      - /share/icons
      - /bin/cups-config
      - /bin/ippeveprinter
      - /bin/ippfind
      - /bin/ipptool
      - /include
      - /lib/*.a
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://github.com/OpenPrinting/cups/releases/download/v2.4.11/cups-2.4.11-source.tar.gz
        sha256: 9a88fe1da3a29a917c3fc67ce6eb3178399d68e1a548c6d86c70d9b13651fd71

  - name: indipdf
    buildsystem: simple
    build-commands:
      - install -Dm755 indipdf ${FLATPAK_DEST}/bin/indipdf
      - install -Dm644 com.indomitusgroup.indipdf.desktop ${FLATPAK_DEST}/share/applications/com.indomitusgroup.indipdf.desktop
      - install -Dm644 com.indomitusgroup.indipdf.metainfo.xml ${FLATPAK_DEST}/share/metainfo/com.indomitusgroup.indipdf.metainfo.xml
      - install -Dm644 icons/32x32.png ${FLATPAK_DEST}/share/icons/hicolor/32x32/apps/com.indomitusgroup.indipdf.png
      - install -Dm644 icons/64x64.png ${FLATPAK_DEST}/share/icons/hicolor/64x64/apps/com.indomitusgroup.indipdf.png
      - install -Dm644 icons/128x128.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/com.indomitusgroup.indipdf.png
      - install -Dm644 icons/256x256.png ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/com.indomitusgroup.indipdf.png
      - install -Dm644 icons/512x512.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/com.indomitusgroup.indipdf.png
    sources:
      - type: archive
        url: https://downloads.indomitusgroup.com/indipdf/indipdf-1.1.0-linux-x86_64.tar.gz
        sha256: 3467eb3213d9866d99943da7ec1f04a11c1571dba7a0b12ff9dcd3cec9f374d4
